<!DOCTYPE html>
<html lang="en" dir=" ltr ">

<head>
    <meta name="generator" content="Hugo 0.82.0" /> <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="斐波那契数列 $  斐波那契数列是形如 $1,1,2,3,5,8,\cdots$ 的数列。求数列的第 $n$ 项。
$f[n]$ 表示数列的第 $n$ 项，则：
$$ f[n]=f[n-1]&#43;f[n-2],n≥3 $$
   初始条件 $f[1]=f[2]=1$ 计算顺序 $f[3\rightarrow n]$     边界条件 $f[n]$ 时间复杂度 $O(n)$    int f[]; f[1] = f[2] = 1; for(int i = 3; i &lt;= n; i &#43;&#43;) f[i] = f[i - 1] &#43; f[i - 2]; 汉诺塔问题 $  汉诺塔由 $n$ 个大小不同的圆盘和三根杆子 $a,b,c$ 组成。初始时，$n$个圆盘从大到小依次套在 $a$ 杆上，如下图所示：
现在要求把 $a$ 杆上的 $n$ 个圆盘按以下规则移到 $c$ 杆上："><meta property="og:title" content="基础 DP" />
<meta property="og:description" content="斐波那契数列 $  斐波那契数列是形如 $1,1,2,3,5,8,\cdots$ 的数列。求数列的第 $n$ 项。
$f[n]$ 表示数列的第 $n$ 项，则：
$$ f[n]=f[n-1]&#43;f[n-2],n≥3 $$
   初始条件 $f[1]=f[2]=1$ 计算顺序 $f[3\rightarrow n]$     边界条件 $f[n]$ 时间复杂度 $O(n)$    int f[]; f[1] = f[2] = 1; for(int i = 3; i &lt;= n; i &#43;&#43;) f[i] = f[i - 1] &#43; f[i - 2]; 汉诺塔问题 $  汉诺塔由 $n$ 个大小不同的圆盘和三根杆子 $a,b,c$ 组成。初始时，$n$个圆盘从大到小依次套在 $a$ 杆上，如下图所示：
现在要求把 $a$ 杆上的 $n$ 个圆盘按以下规则移到 $c$ 杆上：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://freeze.org.cn/docs/DP/basics/" /><meta property="article:section" content="docs" />



<title>基础 DP | Freeze&#39;s Blogs</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.46a4dde4dc554fa8cdae72fbaa505a873b17533a7ffde8fae8e2875889f6fc01.css" integrity="sha256-RqTd5NxVT6jNrnL7qlBahzsXUzp//ej66OKHWIn2/AE=">
<script defer src="/en.search.min.77ee135dbb366802ab21e5696a2eee51aa5b1f5ea717994a73b2d053b2ecc745.js" integrity="sha256-d&#43;4TXbs2aAKrIeVpai7uUapbH16nF5lKc7LQU7Lsx0U="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
--> 
</head>

<body dir=" ltr ">
    <input type="checkbox" class="hidden toggle" id="menu-control" />
    <input type="checkbox" class="hidden toggle" id="toc-control" />
    <main class="container flex">
        <aside class="book-menu">
            <div class="book-menu-content">
                 <nav>
<h2 class="book-brand">
  <a href="/"><img src="/logo.png" alt="Logo" /><span>Freeze&#39;s Blogs</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f4e1054a1a18f4b5cba046970680d31d" class="toggle"  />
    <label for="section-f4e1054a1a18f4b5cba046970680d31d" class="flex justify-between">
      <a  class="">基础算法</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-41ef39c5b40593a842e112d71399835e" class="toggle"  />
    <label for="section-41ef39c5b40593a842e112d71399835e" class="flex justify-between">
      <a  class="">搜索算法</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/Search/bfs/" class="">BFS（广搜）</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/Search/dfs/" class="">DFS（深搜）</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/sort/" class="">排序算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/binary/" class="">二分算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/zip/" class="">状态压缩</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/hipre/" class="">高精度</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-881053f17f484c85378d3c8abfe12511" class="toggle" checked />
    <label for="section-881053f17f484c85378d3c8abfe12511" class="flex justify-between">
      <a  class="">动态规划</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/memo/" class="">记忆化搜索</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/basics/" class=" active">基础 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/knap/" class="">背包 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/interval/" class="">区间 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/digit/" class="">数位 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/tree/" class="">树形 DP</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c52067f201458adbb5455083990e4532" class="toggle"  />
    <label for="section-c52067f201458adbb5455083990e4532" class="flex justify-between">
      <a  class="">数据结构</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/stack/" class="">栈</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/link/" class="">链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/queue/" class="">队列</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/heap/" class="">二叉堆</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/DSU/" class="">并查集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/treearray/" class="">树状数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/segtree/" class="">线段树</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/ST/" class="">ST 表</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-676d83afa8d0b27104552182cc42cf5c" class="toggle"  />
    <label for="section-676d83afa8d0b27104552182cc42cf5c" class="flex justify-between">
      <a  class="">字符串</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/String/hash/" class="">哈希函数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/String/hash-map/" class="">哈希表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/String/KMP/" class="">KMP 算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/String/trie/" class="">Trie 树</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/String/AC-atm/" class="">AC 自动机</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-de3a5001ae8b3f900038d0be772141d6" class="toggle"  />
    <label for="section-de3a5001ae8b3f900038d0be772141d6" class="flex justify-between">
      <a  class="">图论</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/store/" class="">图的存储</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-51cd7eb0a868c10bd862407a54c9232a" class="toggle"  />
    <label for="section-51cd7eb0a868c10bd862407a54c9232a" class="flex justify-between">
      <a  class="">树</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/traversal/" class="">树的遍历</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/LCA/" class="">最近公共祖先</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/MST/" class="">最小生成树</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/path/" class="">最短路</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/topsort/" class="">拓扑排序</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/SCC/" class="">强连通分量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/treap/" class="">Treap 平衡树</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ce95f89a1d24a8066e4c63de0cb15986" class="toggle"  />
    <label for="section-ce95f89a1d24a8066e4c63de0cb15986" class="flex justify-between">
      <a  class="">数论</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/prime/" class="">质数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/factor/" class="">因数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/mod/" class="">同余</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/quickpow/" class="">快速幂</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Tools/" class="">工具</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>

 
                
            </div>
        </aside>

        <div class="book-page">
            <header class="book-header">
                 <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>基础 DP</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>
 
<aside class="hidden clearfix">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#斐波那契数列">斐波那契数列</a></li>
        <li><a href="#汉诺塔问题">汉诺塔问题</a></li>
        <li><a href="#骨牌问题">骨牌问题</a></li>
        <li><a href="#平面分割">平面分割</a></li>
        <li><a href="#最长上升子序列lis">最长上升子序列（LIS）</a>
          <ul>
            <li><a href="#单调栈优化">单调栈优化</a></li>
          </ul>
        </li>
        <li><a href="#最长公共子序列lcs">最长公共子序列（LCS）</a></li>
        <li><a href="#数字金字塔">数字金字塔</a></li>
        <li><a href="#数字矩阵">数字矩阵</a></li>
        <li><a href="#前缀和">前缀和</a>
          <ul>
            <li><a href="#一维前缀和">一维前缀和</a></li>
            <li><a href="#二维前缀和">二维前缀和</a></li>
          </ul>
        </li>
        <li><a href="#差分">差分</a></li>
      </ul>
    </li>
  </ul>
</nav>  
</aside>
 
                
            </header>

             
<article class="markdown"><h2 id="斐波那契数列">
  斐波那契数列
  <a class="anchor" href="#%e6%96%90%e6%b3%a2%e9%82%a3%e5%a5%91%e6%95%b0%e5%88%97">$</a>
</h2>
<p>斐波那契数列是形如 $1,1,2,3,5,8,\cdots$ 的数列。求数列的第 $n$ 项。</p>
<p>$f[n]$ 表示数列的第 $n$ 项，则：</p>
<p>$$
f[n]=f[n-1]+f[n-2],n≥3
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[1]=f[2]=1$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[3\rightarrow n]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$f[n]$</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n)$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[];</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">];</span>
</code></pre></div><h2 id="汉诺塔问题">
  汉诺塔问题
  <a class="anchor" href="#%e6%b1%89%e8%af%ba%e5%a1%94%e9%97%ae%e9%a2%98">$</a>
</h2>
<p>汉诺塔由 $n$ 个大小不同的圆盘和三根杆子 $a,b,c$ 组成。初始时，$n$个圆盘从大到小依次套在 $a$ 杆上，如下图所示：</p>
<center><img src=/DP/basics_1.png style="zoom:80%"></img></center>
<p>现在要求把 $a$ 杆上的 $n$ 个圆盘按以下规则移到 $c$ 杆上：</p>
<ol>
<li>
<p>一次只能移动一个圆盘；</p>
</li>
<li>
<p>圆盘只能存放在柱子上；</p>
</li>
<li>
<p>在移动的过程中，大圆盘不能压在小圆盘上。</p>
</li>
</ol>
<p>求圆盘的最少移动次数。</p>
<p>$f[n]$ 表示将 $n$ 个圆盘从一个杆整体移到另一个杆，需要的最少移动次数。</p>
<p>将 $n$ 个盘子从小到大编号为 $1\sim n$。将它们从 $a$ 杆移到 $c$ 杆，需要做以下 $3$ 步：</p>
<ol>
<li>
<p>将 $a$ 杆上的 $1\sim n-1$ 号盘移至 $b$ 杆，总移动次数为 $f[n-1]$；</p>
</li>
<li>
<p>将 $a$ 杆上的 $n$ 号盘移至 $c$ 杆，总移动次数为 $1$；</p>
</li>
<li>
<p>将 $b$ 杆上的 $1\sim n-1$ 号盘移至 $c$ 杆，总移动次数为 $f[n-1]$。</p>
</li>
</ol>
<p>$$
f[n]=2·f[n-1]+1,n≥1
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[1]=1$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[2\rightarrow n]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$f[n]$</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n)$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[];</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</code></pre></div><h2 id="骨牌问题">
  骨牌问题
  <a class="anchor" href="#%e9%aa%a8%e7%89%8c%e9%97%ae%e9%a2%98">$</a>
</h2>
<p>用若干个 $1×2$ 的骨牌铺满 $2×n$ 的方格。如图为 $n=3$ 时的所有铺法：</p>
<center><img src=/DP/basics_2.png style="zoom:80%"></img></center>
<p>求任意的 $n$ 对应的铺法总数。</p>
<p>$f[n]$ 表示 $2×n$ 方格的铺法总数。对于不好分析的问题，先用枚举法找出规律：</p>
<ul>
<li>
<p>若 $n=1$，显然只有一种铺法，$f[1]=1$；</p>
</li>
<li>
<p>若 $n=2$，可以全部竖放，或全部横放，$f[2]=2$</p>
</li>
<li>
<p>若 $n=3$，可以全部竖放，或一个竖放，两个横放，共 $3$ 种放法。$f[3]=3$。</p>
</li>
</ul>
<center><img src=/DP/basics_3.png style="zoom:80%"></img></center>
<p>总结出一般规律：</p>
<ul>
<li>
<p>若第一个骨牌竖放在左边，则剩下 $2×(n-1)$ 个方格未铺满，铺法数为 $f[n-1]$；</p>
</li>
<li>
<p>若第一个骨牌横放在左上角，为了不留空，第二个骨牌必须横放在它的正下方。剩下 $2×(n-2)$ 个方格未铺满，铺法数为 $f[n-2]$。</p>
</li>
</ul>
<p>$$
f[n]=f[n-1]+f[n-2],n≥3
$$</p>
<p>状态转移方程恰好和
  <a href="/docs/DP/basics/#%e6%96%90%e6%b3%a2%e9%82%a3%e5%a5%91%e6%95%b0%e5%88%97">斐波那契数列</a>相同。</p>
<blockquote class="book-hint info">
  <p><strong>Info</strong></p>
<p>不同问题的状态转移方程可能相同。</p>

</blockquote>

<h2 id="平面分割">
  平面分割
  <a class="anchor" href="#%e5%b9%b3%e9%9d%a2%e5%88%86%e5%89%b2">$</a>
</h2>
<p>平面上有 $n$ 条封闭曲线，每 $2$ 条封闭曲线恰好相交于 $2$ 点，且每 $3$ 条封闭曲线不交于同一点。求 $n$ 条封闭曲线把平面分割成的区域个数。</p>
<center><img src="\DP\basics_4.png" style="zoom:80%"></img></center>
<p>$a[n]$ 表示 $n$ 条封闭曲线分割成的区域个数，由上图可得：$a[2]-a[1]=2$，$a[3]-a[2]=4$，$a[4]-a[3]=6$，总结出规律: $a[n]-a[n-1]=2(n-1)$。变形得：</p>
<p>$$
a[n]=a[n-1]+2(n-1),n≥1
$$</p>
<p>正确性证明：</p>
<p>新增一条曲线时：</p>
<p>$∵$ 每与平面上一条已有曲线相交一次，就会增加一个区域，</p>
<p>$∴$ 新增区域数 $=$ 新增交点数。</p>
<p>$∵$ 新增的第 $n$ 条曲线与已有的 $n-1$ 条曲线各有 $2$ 个交点，</p>
<p>$∴$ 新增区域数 $=$ 新增交点数 $=2·(n-1)$。</p>
<p>$∴$ 现有区域个数 $a[n]=$ 原有区域个数 $+$ 新增区域个数 $=a[n-1]+2(n-1)$。</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$a[1]=2$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$a[2\rightarrow n]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$a[n]$</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n)$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[];</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><h2 id="最长上升子序列lis">
  最长上升子序列（LIS）
  <a class="anchor" href="#%e6%9c%80%e9%95%bf%e4%b8%8a%e5%8d%87%e5%ad%90%e5%ba%8f%e5%88%97lis">$</a>
</h2>
<blockquote class="book-hint info">
  <p><strong>Info</strong></p>
<p>$A$ 的任意子序列 $B$ 可以表示为 $B={A_{k_1} \ ,A_{k_2} \ ,\cdots,A_{k_p} \ }$ ，其中 $k_1&lt;k_2&lt;\cdots&lt;k_p$ 。</p>
<p>若 $A$ 的子序列 $B$ 满足 $A_{k_1}&lt;A_{k_2}&lt;\cdots&lt;A_{k_p}$ ，则 $B$ 是 $A$ 的上升子序列。</p>

</blockquote>

<p>数列 $A$ 的长度为 $n$，求 $A$ 的最长上升子序列的长度。</p>
<p>样例：$A={2,3,6,4,5,1}$，最长上升子序列 $={2,3,4,5}$，长度为 $4$。</p>
<p>$f[i]$ 表示以 $A_i$ 结尾的最长上升子序列的长度。求 $f[i]$ 时，子问题 $f[1\sim i-1]$ 已求得最优解，故枚举 $j=1\cdots i-1$ 并做以下判断：</p>
<ul>
<li>
<p>若 $A_j&lt;A_i$，则 $A_i$ 可以接在 $A_j$ 之后，最长上升子序列长度为 $f[j]+1$；</p>
</li>
<li>
<p>若 $A_j≥A_i$，则 $A_i$ 不可以接在 $A_j$ 之后，跳过。</p>
</li>
</ul>
<p>$$
f[i]=\max_{j&lt;i, \ A_j&lt;A_i}(f[j])+1
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[1\cdots n]=1$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[1\rightarrow n]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$f[1\cdots n]$ 的最大值</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n^2)$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="单调栈优化">
  单调栈优化
  <a class="anchor" href="#%e5%8d%95%e8%b0%83%e6%a0%88%e4%bc%98%e5%8c%96">$</a>
</h3>
<p>运用 
  <a href="/docs/DS/stack/#%e5%8d%95%e8%b0%83%e6%a0%88">单调栈</a> 优化时间复杂度。依次扫描数组元素：</p>
<ul>
<li>
<p>若当前元素大于栈顶元素，则将其插入单调栈；</p>
</li>
<li>
<p>否则二分查找栈中第一个比当前元素大的元素，并替换。</p>
</li>
</ul>
<p>由于 <code>STL Stack</code> 不支持访问栈内元素，故使用 <code>STL Vector</code> 模拟栈。最终的答案是栈的长度。时间复杂度为 $O(n\log{n})$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#000">vector</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]);</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">back</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push_back</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
    <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">lower_bound</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">begin</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">end</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="最长公共子序列lcs">
  最长公共子序列（LCS）
  <a class="anchor" href="#%e6%9c%80%e9%95%bf%e5%85%ac%e5%85%b1%e5%ad%90%e5%ba%8f%e5%88%97lcs">$</a>
</h2>
<blockquote class="book-hint info">
  <p><strong>Info</strong></p>
<p>若一个序列既是 $A$ 的子序列，又是 $B$ 的子序列，则它是 $A$ 和 $B$ 的公共子序列。</p>

</blockquote>

<p>给定长度分别为 $n$ 和 $m$ 的两个字符串 $A$、$B$，求 $A$ 和 $B$ 的最长公共子序列[^LCS]长度。</p>
<p>样例：$A=$ <code>freeze</code>，$B=$ <code>refeze</code>，最长公共子序列 $=$ <code>reeze</code>，长度为 $5$。</p>
<p>$f[i,j]$ 表示 $A[1\cdots i]$ 和 $B[1\cdots j]$ 的最长公共子序列长度。</p>
<ul>
<li>
<p>若 $A_i≠B_j$，则继承最优子状态。子问题 $f[i-1,j]$ 和 $f[i,j-1]$ 已求得最优解，故令 $f[i,j]=\max(f[i-1,j],f[i,j-1])$；</p>
</li>
<li>
<p>若 $A_i=B_j$，则 $A_i$（或 $B_j$）可以接在 $A[1\cdots i-1]$ 和 $B[1\cdots j-1]$ 的最长公共子序列之后，生成的新序列长度为 $f[i-1,j-1]+1$。</p>
</li>
</ul>
<xmp>
$$
f[i,j]=\max\left\{\begin{aligned}
&f[i-1,j]\\
&f[i,j-1]\\
&f[i-1,j-1]+1,A_i=B_j
\end{aligned}\right.
$$
</xmp>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">无</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[i=1\rightarrow n,j=1\rightarrow m]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$f[n,m]$</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(nm)$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]);</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="数字金字塔">
  数字金字塔
  <a class="anchor" href="#%e6%95%b0%e5%ad%97%e9%87%91%e5%ad%97%e5%a1%94">$</a>
</h2>
<p>三角矩阵 $A$ 有 $n$ 行，第 $i$ 行有 $i$ 列。从第一行第一列出发，每次可以移动到下一行相邻的两个数字。到达底部时，经过的数字之和最大为多少？</p>
<p>样例：</p>
<p><img src=/DP/basics_5.png style="zoom:80%"></img></p>
<p>最优路径为 $13→8→26→15$，最大值为 $62$。</p>
<p>$(i,j)$ 表示矩阵第 $i$ 行第 $j$ 列的数字。$f[i,j]$ 表示走到 $(i,j)$ 时，经过的数字之和的最大值。</p>
<p>采用逆推法：要想走到 $(i,j)$，上一步只能在 $(i-1,j-1)$ 或 $(i-1,j)$：</p>
<ul>
<li>
<p>若上一步在 $(i-1,j-1)$，则 $f[i,j]=(i,j)+f[i-1,j-1]$；</p>
</li>
<li>
<p>若上一步 $(i-1,j)$，则 $f[i,j]=(i,j)+f[i-1,j]$。</p>
</li>
</ul>
<xmp>
$$
f[i,j]=(i,j)+\max\left\{\begin{aligned}
&f[i-1,j-1]\\
&f[i-1,j]
\end{aligned}\right.
$$
</xmp>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[1,1]=(1,1)$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[i=2\rightarrow n,j=1\rightarrow i]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$f[n,1\cdots n]$ 的最大值</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n^2)$</td>
</tr>
</tbody>
</table>
<blockquote class="book-hint warning">
  <p><strong>Warning</strong></p>
<p>当 $j=1$ 或 $j=i$ 时，$f[i-1,j-1]$ 和 $f[i-1,j]$ 会越界。读入数据前要将 $f$ 数组初始化为 $-∞$，从而使越界的元素在取最大值时被自动淘汰。</p>

</blockquote>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#000">memset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0x80</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">sizeof</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">ans</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ans</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">n</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h2 id="数字矩阵">
  数字矩阵
  <a class="anchor" href="#%e6%95%b0%e5%ad%97%e7%9f%a9%e9%98%b5">$</a>
</h2>
<p>数字矩阵 $A$ 有 $n$ 行 $m$ 列。从左上角的元素出发，每次只能向下或向左走。到达右下角时，经过的数字之和最大为多少？</p>
<p>样例：</p>
<p><img src=/DP/basics_6.png style="zoom:80%"></img></p>
<p>最优路径为 $17→1→20→12→9→2$，最大值为 $61$。</p>
<p>$(i,j)$ 表示矩阵第 $i$ 行第 $j$ 列的数字。$f[i,j]$ 表示走到 $(i,j)$ 时，经过的数字之和的最大值。</p>
<p>由于只能向左走或向下走，要走到 $(i,j)$，上一步只能在 $(i-1,j)$ 或 $(i,j-1)$：</p>
<xmp>
$$
f[i,j]=(i,j)+\max\left\{\begin{aligned}
&f[i-1,j]\\
&f[i,j-1]
\end{aligned}\right.
$$
</xmp>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[1,1]=(1,1)$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[i=1\rightarrow n,j=1\rightarrow m]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">边界条件</td>
<td style="text-align:center">$f[n,m]$</td>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(nm)$</td>
</tr>
</tbody>
</table>
<blockquote class="book-hint warning">
  <p><strong>Warning</strong></p>
<p>当 $i=1$ 或 $j=1$ 时，$f[i-1,j]$ 和 $f[i,j-1]$ 会越界。同样需要将 $f$ 数组初始化为 $-∞$。</p>

</blockquote>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#000">memset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0x80</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">sizeof</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]);</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="前缀和">
  前缀和
  <a class="anchor" href="#%e5%89%8d%e7%bc%80%e5%92%8c">$</a>
</h2>
<p>前缀和是一种重要的预处理技巧，能大幅降低「查询区间元素和」的时间复杂度。</p>
<h3 id="一维前缀和">
  一维前缀和
  <a class="anchor" href="#%e4%b8%80%e7%bb%b4%e5%89%8d%e7%bc%80%e5%92%8c">$</a>
</h3>
<p>数列 $A$ 有 $n$ 个元素，$f[i]$ 表示 $A_1+A_2+\cdots+A_i$，则有：</p>
<p>$$
f[i]=f[i-1]+A_i
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[0]=0$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[1]\rightarrow f[n]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n)$</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>前缀和可以实现快速查询数列的子段和。$g[i,j]$ 表示从 $A_i$ 到 $A_j$ 的所有元素和，则有：</p>
<center><img src=/DP/basics_7.png style="zoom:80%"></img></center>
<p>$$
g[i,j]=f[j]-f[i-1]
$$</p>
<p>单次查询的时间复杂度为 $O(1)$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">j</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">];</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span>
    <span style="color:#204a87;font-weight:bold">while</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="二维前缀和">
  二维前缀和
  <a class="anchor" href="#%e4%ba%8c%e7%bb%b4%e5%89%8d%e7%bc%80%e5%92%8c">$</a>
</h3>
<p>矩阵 $A$ 有 $n$ 行 $m$ 列。$f[i,j]$ 表示以 $(1,1)$ 为左上角，以 $(i,j)$ 为右下角的子矩阵的元素和，则：</p>
<center><img src=/DP/basics_8.png style="zoom:80%"></img></center>
<p>$$
f[i,j]=f[i-1,j]+f[i,j-1]-f[i-1,j-1]+(i,j)
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[0,0]=0$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[1\rightarrow n,1\rightarrow m]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(nm)$</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>二维前缀和可以实现快速查询子矩阵元素和。$g[x_1,y_1,x_2,y_2]$ 表示以 $(x_1,y_1)$ 为左上角，$(x_2,y_2)$ 为右下角的子矩阵元素和，则：</p>
<center><img src=/DP/basics_9.png style="zoom:80%"></img></center>
<p>$$
g[x_1,y_1,x_2,y_2]=f[x_2,y_2]-f[x_1-1,y_2]-f[x_2,y_1-1]+f[x_1-1,y_1-1]
$$</p>
<p>单次查询的时间复杂度为 $O(1)$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">x1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">y1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">x2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">y2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">x2</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">y2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">x1</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">y2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">x2</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">y1</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">x1</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">y1</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">];</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">];</span>
    <span style="color:#204a87;font-weight:bold">while</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">x1</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">y1</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">x2</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">y2</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="差分">
  差分
  <a class="anchor" href="#%e5%b7%ae%e5%88%86">$</a>
</h2>
<p>差分是 
  <a href="/docs/DP/basics/#%e5%89%8d%e7%bc%80%e5%92%8c">前缀和</a> 的逆运算，能大幅降低「区间批量操作」的时间复杂度。</p>
<p>数列 $A$ 有 $n$ 个元素。$f[i]$ 代表数列 $A$ 第 $i$ 项和前一项的差，即：</p>
<p>$$
f[i]=A_i-A_{i-1}
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">初始条件</th>
<th style="text-align:center">$f[1]=A_1$</th>
<th style="text-align:center">计算顺序</th>
<th style="text-align:center">$f[1\rightarrow n]$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">时间复杂度</td>
<td style="text-align:center">$O(n)$</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>$f$ 被称作「差分数列」。数列 $A={5,2,3,1,6,4}$ 的差分数列为 $f={5,-3,1,-2,5,-2}$。</p>
<p>将 $A[l\cdots r]$ 中的每个元素都加上 $x$ 时，差分数列中 $f[l]$ 增加了 $x$，$f[r+1]$ 减少了 $x$，其余元素不变。因此每次只修改 $f[l]$ 和 $f[r+1]$ 的值，最后通过 $f$ 数列还原 $A$ 中的元素，即：</p>
<p>$$
A_i=A_{i-1}+f[i]
$$</p>
<p>单次批量操作的时间复杂度为 $O(1)$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">l</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#8f5902;font-style:italic">// 将区间 [l, r] 批量加 x
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">-=</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">query</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic">// 还原数组元素
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">];</span>
    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">l</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">while</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000">query</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></article>

            
            

            <footer class="book-footer">
                 <div class="flex flex-wrap justify-between">
      
    <div style="margin:0 auto">
        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">
            <span>闽 ICP 备 2021002587 号</span>
        </a>
    </div>
</div> 
                
                
            </footer>

              
            

            <label for="menu-control" class="hidden book-menu-overlay"></label>
        </div>

        
        <aside class="book-toc">
            <div class="book-toc-content">
                  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#斐波那契数列">斐波那契数列</a></li>
        <li><a href="#汉诺塔问题">汉诺塔问题</a></li>
        <li><a href="#骨牌问题">骨牌问题</a></li>
        <li><a href="#平面分割">平面分割</a></li>
        <li><a href="#最长上升子序列lis">最长上升子序列（LIS）</a>
          <ul>
            <li><a href="#单调栈优化">单调栈优化</a></li>
          </ul>
        </li>
        <li><a href="#最长公共子序列lcs">最长公共子序列（LCS）</a></li>
        <li><a href="#数字金字塔">数字金字塔</a></li>
        <li><a href="#数字矩阵">数字矩阵</a></li>
        <li><a href="#前缀和">前缀和</a>
          <ul>
            <li><a href="#一维前缀和">一维前缀和</a></li>
            <li><a href="#二维前缀和">二维前缀和</a></li>
          </ul>
        </li>
        <li><a href="#差分">差分</a></li>
      </ul>
    </li>
  </ul>
</nav>  
                
            </div>
        </aside>
        
    </main>

    
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/katex/katex.min.js"></script>
<script src="/katex/auto-render.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [{
                left: "$$",
                right: "$$",
                display: true
            }, {
                left: "$",
                right: "$",
                display: false
            }]
        });
    });
</script>

<script type="text/javascript">
    String.prototype.pxWidth = function(font) {
        var canvas = String.prototype.pxWidth.canvas || (String.prototype.pxWidth.canvas = document.createElement("canvas")),
            context = canvas.getContext("2d"); 
        font && (context.font = font);
        var metrics = context.measureText(this);
        return metrics.width;
    }
    var len = document.getElementsByClassName("book-btn").length;
    for(var i = 0; i < len; i ++) {
        var str = document.getElementsByClassName("book-btn")[i].innerHTML;
        var wid = (100 - str.pxWidth(document.getElementsByClassName("book-btn")[i].style.font)) / 2.3;
        document.getElementsByClassName("book-btn")[i].style.padding = "0 " + wid.toString() + "px";
    }
</script>
</body>

</html>

     