<!DOCTYPE html>
<html lang="en" dir=" ltr ">

<head>
    <meta name="generator" content="Hugo 0.82.0" /> <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="01 背包 $  用体积为 $m$ 的背包装 $n$ 种物品，每种物品只有 $1$ 个。第 $i$ 种物品的体积为 $w_i$，价值为 $c_i$，将哪些物品装入背包可使总价值最大？
$f[i,v]$ 表示把前 $i$ 个物品（部分或全部）放入体积为 $v$ 的背包，可以获得的最大总价值。
若只考虑第 $i$ 个物品的策略（放或不放），则问题转而只涉及到前 $i-1$ 个物品：
  若不放第 $i$ 个物品，则 $f[i,v]=f[i-1,v]$；
  若放第 $i$ 个物品，则前 $i-1$ 个物品只能放在体积为 $v-w_i$ 的空间里，故 $f[i,v]=f[i-1,v-w_i]&#43;c_i$。
  $$f[i,v] = \max\left\{\begin{aligned}&f[i-1,v]\\&f[i-1,v-w_i]&#43;c_i,v≥w_i\end{aligned}\right.$$由于 $f[i,v]$ 的值只由 $f[i-1,v]$ 和 $f[i-1,v-w_i]$ 决定，所以先求 $f[1,0\cdots m]$，再求 $f[2,0\cdots m]$，$\cdots$，直到求出 $f[n,m]$。时间复杂度为 $O(nm)$。
Warning
当 $v &lt; w_i$ 时，第 $i$ 个物品放不进体积为 $v$ 的背包，此时 $f[i,v]$ 只能等于 $f[i-1,v]$。"><meta property="og:title" content="背包 DP" />
<meta property="og:description" content="01 背包 $  用体积为 $m$ 的背包装 $n$ 种物品，每种物品只有 $1$ 个。第 $i$ 种物品的体积为 $w_i$，价值为 $c_i$，将哪些物品装入背包可使总价值最大？
$f[i,v]$ 表示把前 $i$ 个物品（部分或全部）放入体积为 $v$ 的背包，可以获得的最大总价值。
若只考虑第 $i$ 个物品的策略（放或不放），则问题转而只涉及到前 $i-1$ 个物品：
  若不放第 $i$ 个物品，则 $f[i,v]=f[i-1,v]$；
  若放第 $i$ 个物品，则前 $i-1$ 个物品只能放在体积为 $v-w_i$ 的空间里，故 $f[i,v]=f[i-1,v-w_i]&#43;c_i$。
  $$f[i,v] = \max\left\{\begin{aligned}&f[i-1,v]\\&f[i-1,v-w_i]&#43;c_i,v≥w_i\end{aligned}\right.$$由于 $f[i,v]$ 的值只由 $f[i-1,v]$ 和 $f[i-1,v-w_i]$ 决定，所以先求 $f[1,0\cdots m]$，再求 $f[2,0\cdots m]$，$\cdots$，直到求出 $f[n,m]$。时间复杂度为 $O(nm)$。
Warning
当 $v &lt; w_i$ 时，第 $i$ 个物品放不进体积为 $v$ 的背包，此时 $f[i,v]$ 只能等于 $f[i-1,v]$。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://freeze.org.cn/docs/DP/knap/" /><meta property="article:section" content="docs" />



<title>背包 DP | Freeze&#39;s Blogs</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.03f1ef6f89a29f5bb3a1013af5f27d000ba3e08765de06c8c9487bfb6c5ecd6a.css" integrity="sha256-A/Hvb4min1uzoQE69fJ9AAuj4Idl3gbIyUh7&#43;2xezWo=">
<<<<<<< HEAD
<script defer src="/en.search.min.cdfcd48357937d7f498e8985d72e47f3d305448b8e6e08d74660d1e7f03978db.js" integrity="sha256-zfzUg1eTfX9JjomF1y5H89MFRIuObgjXRmDR5/A5eNs="></script>
=======
<script defer src="/en.search.min.4c57398875ec51f0692c1f62ab0946fb1c8ae742e8d16304a12e4b2b7a0acfbc.js" integrity="sha256-TFc5iHXsUfBpLB9iqwlG&#43;xyK50Lo0WMEoS5LK3oKz7w="></script>
>>>>>>> 348abda768c2d46f07ff3fdeed20cbb5f111c98c
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
--> 
</head>

<body dir=" ltr ">
    <input type="checkbox" class="hidden toggle" id="menu-control" />
    <input type="checkbox" class="hidden toggle" id="toc-control" />
    <main class="container flex">
        <aside class="book-menu">
            <div class="book-menu-content">
                 <nav>
<h2 class="book-brand">
  <a href="/"><img src="/logo.png" alt="Logo" /><span>Freeze&#39;s Blogs</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f4e1054a1a18f4b5cba046970680d31d" class="toggle"  />
    <label for="section-f4e1054a1a18f4b5cba046970680d31d" class="flex justify-between">
      <a  class="">基础算法</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/bfs/" class="">广度优先搜索</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/dfs/" class="">深度优先搜索</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/sort/" class="">排序算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/binary/" class="">二分算法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/zip/" class="">状态压缩</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Basics/hipre/" class="">高精度</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-881053f17f484c85378d3c8abfe12511" class="toggle" checked />
    <label for="section-881053f17f484c85378d3c8abfe12511" class="flex justify-between">
      <a  class="">动态规划</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/memo/" class="">记忆化搜索</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/basics/" class="">基础 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/knap/" class=" active">背包 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/interval/" class="">区间 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/digit/" class="">数位 DP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DP/tree/" class="">树形 DP</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c52067f201458adbb5455083990e4532" class="toggle"  />
    <label for="section-c52067f201458adbb5455083990e4532" class="flex justify-between">
      <a  class="">数据结构</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/stack/" class="">栈</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/link/" class="">链表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/queue/" class="">队列</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/heap/" class="">二叉堆</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/DSU/" class="">并查集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/treearray/" class="">树状数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/DS/segtree/" class="">线段树</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-de3a5001ae8b3f900038d0be772141d6" class="toggle"  />
    <label for="section-de3a5001ae8b3f900038d0be772141d6" class="flex justify-between">
      <a  class="">图论</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/store/" class="">图的存储</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
<<<<<<< HEAD
    <input type="checkbox" id="section-51cd7eb0a868c10bd862407a54c9232a" class="toggle"  />
    <label for="section-51cd7eb0a868c10bd862407a54c9232a" class="flex justify-between">
      <a  class="">树</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/intro/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/traversal/" class="">树的遍历</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/LCA/" class="">最近公共祖先</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/Tree/MST/" class="">最小生成树</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
=======
>>>>>>> 348abda768c2d46f07ff3fdeed20cbb5f111c98c
    <a href="https://freeze.org.cn/docs/Graph/path/" class="">最短路</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/topsort/" class="">拓扑排序</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/SCC/" class="">强连通分量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Graph/treap/" class="">Treap 平衡树</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ce95f89a1d24a8066e4c63de0cb15986" class="toggle"  />
    <label for="section-ce95f89a1d24a8066e4c63de0cb15986" class="flex justify-between">
      <a  class="">数论</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/prime/" class="">质数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/factor/" class="">因数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Math/mod/" class="">同余</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Tools/" class="">工具</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://freeze.org.cn/docs/Tools/" class="">工具</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>

 
                
            </div>
        </aside>

        <div class="book-page">
            <header class="book-header">
                 <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>背包 DP</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>
 
<aside class="hidden clearfix">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#01-背包">01 背包</a>
          <ul>
            <li><a href="#空间优化">空间优化</a></li>
          </ul>
        </li>
        <li><a href="#完全背包">完全背包</a>
          <ul>
            <li><a href="#空间优化-1">空间优化</a></li>
          </ul>
        </li>
        <li><a href="#多重背包">多重背包</a>
          <ul>
            <li><a href="#转换为-01-背包">转换为 01 背包</a></li>
          </ul>
        </li>
        <li><a href="#分组背包">分组背包</a></li>
        <li><a href="#二维背包">二维背包</a></li>
        <li><a href="#拓展">拓展</a>
          <ul>
            <li><a href="#方案总数">方案总数</a></li>
            <li><a href="#最优方案总数">最优方案总数</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>  
</aside>
 
                
            </header>

             
<article class="markdown"><h2 id="01-背包">
  01 背包
  <a class="anchor" href="#01-%e8%83%8c%e5%8c%85">$</a>
</h2>
<p>用体积为 $m$ 的背包装 $n$ 种物品，每种物品只有 $1$ 个。第 $i$ 种物品的体积为 $w_i$，价值为 $c_i$，将哪些物品装入背包可使总价值最大？</p>
<p>$f[i,v]$ 表示把前 $i$ 个物品（部分或全部）放入体积为 $v$ 的背包，可以获得的最大总价值。</p>
<p>若只考虑第 $i$ 个物品的策略（放或不放），则问题转而只涉及到前 $i-1$ 个物品：</p>
<ul>
<li>
<p>若不放第 $i$ 个物品，则 $f[i,v]=f[i-1,v]$；</p>
</li>
<li>
<p>若放第 $i$ 个物品，则前 $i-1$ 个物品只能放在体积为 $v-w_i$ 的空间里，故 $f[i,v]=f[i-1,v-w_i]+c_i$。</p>
</li>
</ul>
<xmp>
$$
f[i,v] = \max\left\{\begin{aligned}
&f[i-1,v]\\
&f[i-1,v-w_i]+c_i,v≥w_i
\end{aligned}\right.
$$
</xmp>
<p>由于 $f[i,v]$ 的值只由 $f[i-1,v]$ 和 $f[i-1,v-w_i]$ 决定，所以先求 $f[1,0\cdots m]$，再求 $f[2,0\cdots m]$，$\cdots$，直到求出 $f[n,m]$。时间复杂度为 $O(nm)$。</p>
<blockquote class="book-hint warning">
  <p><strong>Warning</strong></p>
<p>当 $v &lt; w_i$ 时，第 $i$ 个物品放不进体积为 $v$ 的背包，此时 $f[i,v]$ 只能等于 $f[i-1,v]$。</p>

</blockquote>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">];</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="空间优化">
  空间优化
  <a class="anchor" href="#%e7%a9%ba%e9%97%b4%e4%bc%98%e5%8c%96">$</a>
</h3>
<p>假设背包体积为 $4$，物品个数为 $3$，体积和价值如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">体积 $w$</th>
<th style="text-align:center">价值 $c$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$2$</td>
</tr>
<tr>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$3$</td>
</tr>
<tr>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$3$</td>
</tr>
</tbody>
</table>
<p>第 $i$ 行第 $v$ 列的格子 $(i,v)$ 存放 $f[i,v]$ 的值。运行 01 背包程序可以得到下表：</p>
<table>
<thead>
<tr>
<th style="text-align:center">$i\setminus v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
<tr>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$5$</td>
</tr>
<tr>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$8$</td>
</tr>
</tbody>
</table>
<p>由于每一行的数据只与上一行有关，事实上可以去掉 $1$ 维：</p>
<xmp>
$$
f[\color{lightgray}i,\color{black}v] = \max\left\{\begin{aligned}
&f[\color{lightgray}i-1,\color{black}v]\\
&f[\color{lightgray}i-1,\color{black}v-w_i]+c_i,v≥w_i
\end{aligned}\right.
$$
</xmp>
<p>需要保证更新 $f[v]$ 时，$f[v-w_i]$ 在第 $i$ 行还没被更新，因此降序枚举 $v$。</p>
<p>用 $1$ 号物品（$w_1=1,c_1=2$）更新 $f[4\cdots 0]$：</p>
<table>
<thead>
<tr>
<th style="text-align:center">$f\setminus v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f$（上一行）</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[4]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\color{blue}{0}$</td>
<td style="text-align:center">$\color{blue}{f[4-1]}\color{red}{+2}$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[3]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\color{blue}{0}$</td>
<td style="text-align:center">$\color{blue}{f[3-1]}\color{red}{+2}$</td>
<td style="text-align:center">$2$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[2]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\color{blue}{0}$</td>
<td style="text-align:center">$\color{blue}{f[2-1]}\color{red}{+2}$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[1]$</td>
<td style="text-align:center">$\color{blue}{0}$</td>
<td style="text-align:center">$\color{blue}{f[1-1]}\color{red}{+2}$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[0]$</td>
<td style="text-align:center">$\color{blue}{f[0]=0}$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
<tr>
<td style="text-align:center">$f$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h2 id="完全背包">
  完全背包
  <a class="anchor" href="#%e5%ae%8c%e5%85%a8%e8%83%8c%e5%8c%85">$</a>
</h2>
<p>如果每种物品都有无限个？</p>
<p>$f[i,v]$ 表示把前 $i$ 种物品放入体积为 $v$ 的背包，可以获得的最大总价值。</p>
<ul>
<li>
<p>若不放第 $i$ 种物品，则 $f[i,v]=f[i-1,v]$；</p>
</li>
<li>
<p>若多放入 $1$ 个第 $i$ 种物品，则剩余的前 $i$ 种物品只能放在体积为 $v-w_i$ 的空间里，故 $f[i,v]=f[i,v-w_i]+c_i$。</p>
</li>
</ul>
<xmp>
$$
f[i,v] = \max\left\{\begin{aligned}
&f[i-1,v]\\
&f[i,v-w_i]+c_i,v≥w_i
\end{aligned}\right.
$$
</xmp>
<p>时间复杂度为 $O(nm)$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">];</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="空间优化-1">
  空间优化
  <a class="anchor" href="#%e7%a9%ba%e9%97%b4%e4%bc%98%e5%8c%96-1">$</a>
</h3>
<p>完全背包同样也可以省去一维：</p>
<xmp>
$$
f[\color{lightgray}i,\color{black}v] = \max\left\{\begin{aligned}
&f[\color{lightgray}i-1,\color{black}v]\\
&f[\color{lightgray}i,\color{black}v-w_i]+c_i,v≥w_i
\end{aligned}\right.
$$
</xmp>
<p>需要保证更新 $f[v]$ 时，$f[v-w_i]$ 在第 $i$ 行已经被更新了，因此升序枚举 $v$。</p>
<p>沿用
  <a href="/docs/DP/knap/#01-%e8%83%8c%e5%8c%85">01 背包</a>的例子，改变 $v$ 的枚举顺序为升序：</p>
<p>用 $1$ 号物品（$w_1=1,c_1=2$）更新 $f[0\cdots 4]$：</p>
<table>
<thead>
<tr>
<th style="text-align:center">$f\setminus v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f$（上一行）</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[0]$</td>
<td style="text-align:center">$\color{blue}{f[0]=0}$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[1]$</td>
<td style="text-align:center">$\color{blue}{0}$</td>
<td style="text-align:center">$\color{blue}{f[1-1]}\color{red}{+2}$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[2]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\color{blue}{2}$</td>
<td style="text-align:center">$\color{blue}{f[2-1]}\color{red}{+2}$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[3]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$\color{blue}{4}$</td>
<td style="text-align:center">$\color{blue}{f[3-1]}\color{red}{+2}$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">更新 $f[4]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$\color{blue}{6}$</td>
<td style="text-align:center">$\color{blue}{f[4-1]}\color{red}{+2}$</td>
</tr>
<tr>
<td style="text-align:center">$f$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$8$</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h2 id="多重背包">
  多重背包
  <a class="anchor" href="#%e5%a4%9a%e9%87%8d%e8%83%8c%e5%8c%85">$</a>
</h2>
<p>如果 $n$ 种物品分别有 $s_1,s_2,\cdots,s_n$ 个？</p>
<p>第 $i$ 个物品有 $s_i+1$ 种策略（取 $0\sim s_i$ 件）。在 
  <a href="/docs/DP/knap/#01-%e8%83%8c%e5%8c%85">01 背包</a>的基础上，再枚举物品个数 $k$，每次绑定 $k$ 个物品当成一个物品。</p>
<xmp>
$$
f[v] = \max\left\{\begin{aligned}
&f[v]\\
&f[v-k·w_i]+k·c_i,v≥k·w_i
\end{aligned}\right.
$$
</xmp>
<p>时间复杂度为 $O(m\sum s_i)$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h3 id="转换为-01-背包">
  转换为 01 背包
  <a class="anchor" href="#%e8%bd%ac%e6%8d%a2%e4%b8%ba-01-%e8%83%8c%e5%8c%85">$</a>
</h3>
<ul>
<li>
<p>在 $1,2,4,\cdots,2^n$ 中选出若干个相加，可以得到 $0\sim 2^{n+1}-1$ 中的任意整数。</p>
</li>
<li>
<p>同理，$1,2,4,\cdots,2^k,n-(2^{k+1}-1)$ 可以组合出 $0\sim n$ 中的任意整数，其中 $k$ 是满足 $n-(2^{k+1}-1)&gt;0$ 的最大整数。</p>
</li>
</ul>
<p>将第 $i$ 种物品拆分成 $\log{s_i}$ 个物品，它们的体积和价值如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">体积 $w$</th>
<th style="text-align:center">$w_i$</th>
<th style="text-align:center">$2w_i$</th>
<th style="text-align:center">$4w_i$</th>
<th style="text-align:center">$\cdots$</th>
<th style="text-align:center">$2^kw_i$</th>
<th style="text-align:center">$[s_i-(2^{k+1}-1)]w_i$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">价值 $v$</td>
<td style="text-align:center">$c_i$</td>
<td style="text-align:center">$2c_i$</td>
<td style="text-align:center">$4c_i$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$2^kc_i$</td>
<td style="text-align:center">$[s_i-(2^{k+1}-1)]c_i$</td>
</tr>
</tbody>
</table>
<p>这些物品可以组合出第 $i$ 个物品的所有选择方案（取 $0\sim s_i$ 件）。用 
  <a href="/docs/DP/knap/#01-%e8%83%8c%e5%8c%85">01 背包</a>的策略处理出最佳选择方案。时间复杂度为 $O(m\sum\log{s_i})$</p>
<blockquote class="book-hint info">
  <p><strong>Info</strong></p>
<p><a href="/docs/DP/knap/#%E5%AE%8C%E5%85%A8%E8%83%8C%E5%8C%85">完全背包</a>也可以用相同的方法进行优化。</p>

</blockquote>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">wi</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ci</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">si</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">wi</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">ci</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">si</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">while</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">si</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000">tot</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">wi</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">k</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tot</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ci</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">k</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000">si</span> <span style="color:#ce5c00;font-weight:bold">-=</span> <span style="color:#000">k</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">*=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000">tot</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">wi</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">si</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tot</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ci</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">si</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">tot</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h2 id="分组背包">
  分组背包
  <a class="anchor" href="#%e5%88%86%e7%bb%84%e8%83%8c%e5%8c%85">$</a>
</h2>
<p>给定 $t$ 组物品，第 $k$ 组有 $s_k$ 个物品，第 $k$ 组第 $i$ 个物品体积为 $w_{k \ i}$，价值为 $c_{k \ i}$。每组中的物品互相冲突，最多选一件。将哪些物品放入背包可使总价值最大？</p>
<p>$f[k,v]$ 表示将前 $k$ 组的物品放入体积为 $v$ 的背包中，可以获得的最大总价值。</p>
<p>第 $k$ 组的选择策略如下：</p>
<xmp>
$$
f[k,v] = \max\left\{\begin{aligned}
&f[k-1,v]\\
&\max_{1≤i≤s_k} \ f[k-1,v-w_{k \ i}]+c_{k \ i},v≥w_{k \ i}
\end{aligned}\right.
$$
</xmp>
<p>和 01 背包类似，同样可以省去一维。时间复杂度为 $O(nm)$。</p>
<p>枚举第 $k$ 组物品的循环应放在最内层。若放在外层，则等价于 01 背包，失去了分组的意义。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">t</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">k</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
			<span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">k</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span>
				<span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">k</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">k</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h2 id="二维背包">
  二维背包
  <a class="anchor" href="#%e4%ba%8c%e7%bb%b4%e8%83%8c%e5%8c%85">$</a>
</h2>
<p>背包的体积为 $m_1$，承重为 $m_2$；物品个数为 $n$，第 $i$ 个物品的体积为 ${w_1}_i$，质量为 ${w_2}_i$，价值为 $c_i$。在背包不过载的同时，将哪些物品装入背包可使总价值最大？</p>
<p>同时枚举体积和质量即可。</p>
<xmp>
$$
f[v_1,v_2] = \max\left\{\begin{aligned}
&f[v_1,v_2]\\
&f[v_1-{w_1}_i,v_2-{w_2}_i]+c_i,v_1≥{w_1}_i,v_2≥{w_2}_i
\end{aligned}\right.
$$
</xmp>
<p>时间复杂度为 $O(nm_1m_2)$。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v1</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w1</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v1</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v2</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w2</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v2</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v2</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v1</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w1</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]][</span><span style="color:#000">v2</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w2</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><h2 id="拓展">
  拓展
  <a class="anchor" href="#%e6%8b%93%e5%b1%95">$</a>
</h2>
<h3 id="方案总数">
  方案总数
  <a class="anchor" href="#%e6%96%b9%e6%a1%88%e6%80%bb%e6%95%b0">$</a>
</h3>
<p>在 
  <a href="/#01-%e8%83%8c%e5%8c%85">01 背包</a>的基础上，将物品放入背包的方案有几种？</p>
<p>$g[i,v]$ 表示把前 $i$ 个物品放入体积为 $v$ 的背包的方案总数。</p>
<ul>
<li>
<p>若不放第 $i$ 个物品，则方案总数为 $g[i-1,v]$；</p>
</li>
<li>
<p>若放第 $i$ 个物品，则方案总数为 $g[i,v-w_i]$。</p>
</li>
</ul>
<p>$$
g[i,v]=g[i-1,v]+g[i-1,v-w_i],v≥w_i
$$</p>
<p>同样可以省去第一维：</p>
<p>$$
g[v]=g[v]+g[v-w_i],v≥w_i
$$</p>
<p>初始条件：$g[0]=1$。因为当背包体积为 $0$ 时只有一个方案：不装任何物品。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span>
</code></pre></div><h3 id="最优方案总数">
  最优方案总数
  <a class="anchor" href="#%e6%9c%80%e4%bc%98%e6%96%b9%e6%a1%88%e6%80%bb%e6%95%b0">$</a>
</h3>
<p>使总价值最大的方案有几种？</p>
<p>已知 
  <a href="/#01-%e8%83%8c%e5%8c%85">01 背包</a>的状态转移方程：</p>
<xmp>
$$
f[i,v] = \max\left\{\begin{aligned}
&f[i-1,v]\\
&f[i-1,v-w_i]+c_i,v≥w_i
\end{aligned}\right.
$$
</xmp>
<p>$g[i,v]$ 表示把前 $i$ 个物品放入体积为 $v$ 的背包的方案总数。</p>
<ul>
<li>
<p>若 $f[i-1,v]&gt;f[i-1,v-w_i]+c_i$，不放物品 $i$ 总价值最大，$g[i,v]=g[i-1,v]$；</p>
</li>
<li>
<p>若 $f[i-1,v]&lt;f[i-1,v-w_i]+c_i$，放物品 $i$ 总价值最大，$g[i,v]=g[i-1,v-w_i]$；</p>
</li>
<li>
<p>若相等，则放或不放都可使总价值最大，$g[i,v]=g[i-1,v]+g[i-1,v-w_i]$。</p>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">];</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]);</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">];</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">][</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]];</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>一维优化版：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">max_f</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">max_g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_f</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#000">max_g</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">];</span>
        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_f</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#000">max_g</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]];</span>
        <span style="color:#000">f</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max_f</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max_g</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></div></article>

            
            

            <footer class="book-footer">
                 <div class="flex flex-wrap justify-between">
      
    <div style="margin:0 auto">
        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">
            <span>闽 ICP 备 2021002587 号</span>
        </a>
    </div>
</div> 
                
                
            </footer>

              
            

            <label for="menu-control" class="hidden book-menu-overlay"></label>
        </div>

        
        <aside class="book-toc">
            <div class="book-toc-content">
                  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#01-背包">01 背包</a>
          <ul>
            <li><a href="#空间优化">空间优化</a></li>
          </ul>
        </li>
        <li><a href="#完全背包">完全背包</a>
          <ul>
            <li><a href="#空间优化-1">空间优化</a></li>
          </ul>
        </li>
        <li><a href="#多重背包">多重背包</a>
          <ul>
            <li><a href="#转换为-01-背包">转换为 01 背包</a></li>
          </ul>
        </li>
        <li><a href="#分组背包">分组背包</a></li>
        <li><a href="#二维背包">二维背包</a></li>
        <li><a href="#拓展">拓展</a>
          <ul>
            <li><a href="#方案总数">方案总数</a></li>
            <li><a href="#最优方案总数">最优方案总数</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>  
                
            </div>
        </aside>
        
    </main>

    
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/katex/katex.min.js"></script>
<script src="/katex/auto-render.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [{
                left: "$$",
                right: "$$",
                display: true
            }, {
                left: "$",
                right: "$",
                display: false
            }]
        });
    });
</script>
</body>

</html>

     